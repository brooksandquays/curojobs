<!-- filepath: employer-dashboard-index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CuroJobs - Employer Dashboard</title>
  <link rel="icon" type="image/png" sizes="56x56" href="../../images/fav-icon/icon.png">
  <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" media="all">
  <link rel="stylesheet" type="text/css" href="../../css/style.css" media="all">
  <link rel="stylesheet" type="text/css" href="../../css/responsive.css" media="all">
</head>

<body>
<div class="main-page-wrapper">
  <aside class="dash-aside-navbar">
    <div class="position-relative">
      <div class="logo text-md-center d-flex align-items-center justify-content-center">
        <a href="../../index.html"><img src="../../images/logo/logo_02.png" alt=""></a>
      </div>
      <div class="user-data text-center">
        <div class="user-avatar online position-relative rounded-circle">
          <img src="../../images/avatar_01.jpg" alt="" class="lazy-img">
        </div>
        <div class="user-name-data mt-2">
          <div id="profile-name" class="fw-500">Employer</div>
        </div>
      </div>

      <nav class="dasboard-main-nav">
        <ul class="style-none">
          <li><a href="employer-dashboard-index.html" class="d-flex w-100 align-items-center active"><img src="../../images/icon/icon_1_active.svg" alt=""><span>Dashboard</span></a></li>
          <li><a href="employer-dashboard-profile.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_2.svg" alt=""><span>My Profile</span></a></li>
          <li><a href="employer-dashboard-jobs.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_3.svg" alt=""><span>My Jobs</span></a></li>
          <li><a href="employer-dashboard-submit-job.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_39.svg" alt=""><span>Submit Job</span></a></li>
          <li><a href="employer-dashboard-message.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_4.svg" alt=""><span>Messages</span></a></li>
          <li><a href="employer-dashboard-message-setting.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_7.svg" alt=""><span>Msg Settings</span></a></li>
          <li class="border-top pt-10 mt-10"><a href="../../index.html" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_8.svg" alt=""><span>Back to Home</span></a></li>
          <li><a href="#" id="logout-btn" class="d-flex w-100 align-items-center"><img src="../../images/icon/icon_9.svg" alt=""><span>Logout</span></a></li>
        </ul>
      </nav>
    </div>
  </aside>

  <div class="dashboard-body">
    <div class="position-relative">
      <header class="dashboard-header">
        <div class="d-flex align-items-center justify-content-end">
          <button class="dash-mobile-nav-toggler d-block d-md-none me-auto"><span></span></button>
          <div><a href="employer-dashboard-submit-job.html" class="job-post-btn tran3s">Post a Job</a></div>
        </div>
      </header>

      <h2 class="main-title">Dashboard</h2>

      <!-- Metrics -->
      <div class="row">
        <div class="col-lg-4 col-6">
          <div class="dash-card-one bg-white border-30 position-relative mb-15">
            <div class="d-sm-flex align-items-center justify-content-between">
              <div class="icon rounded-circle d-flex align-items-center justify-content-center order-sm-1">
                <img src="../../images/icon/icon_12.svg" alt="">
              </div>
              <div class="order-sm-0">
                <div class="value fw-500" id="posted-jobs-count">0</div>
                <span>Posted Jobs</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-6">
          <div class="dash-card-one bg-white border-30 position-relative mb-15">
            <div class="d-sm-flex align-items-center justify-content-between">
              <div class="icon rounded-circle d-flex align-items-center justify-content-center order-sm-1">
                <img src="../../images/icon/icon_13.svg" alt="">
              </div>
              <div class="order-sm-0">
                <div class="value fw-500" id="active-jobs-count">0</div>
                <span>Active Jobs</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-6">
          <div class="dash-card-one bg-white border-30 position-relative mb-15">
            <div class="d-sm-flex align-items-center justify-content-between">
              <div class="icon rounded-circle d-flex align-items-center justify-content-center order-sm-1">
                <img src="../../images/icon/icon_14.svg" alt="">
              </div>
              <div class="order-sm-0">
                <div class="value fw-500" id="closed-jobs-count">0</div>
                <span>Closed / Expired Jobs</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Posted Jobs -->
      <div class="row pt-40">
        <div class="col-lg-12">
          <div class="recent-job-tab bg-white border-20 mt-30 w-100">
            <h4 class="dash-title-two">Recent Posted Jobs</h4>
            <div id="posted-jobs-container" class="wrapper p-3 text-center">Loading jobs...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../../vendor/jwt-decode.js"></script>
  <script src="../../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    const token = localStorage.getItem('accessToken');
    if (!token) return location.href='../../login.html';

    const api = async (url) => {
      const r = await fetch('http://127.0.0.1:8000/api/v1/' + url, {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (r.status === 401) { localStorage.clear(); location.href='../../login.html'; }
      return r.json();
    };

    // --- Load company profile ---
    try {
      const profile = await api('accounts/profile/company/');
      document.getElementById('profile-name').textContent = profile.name || 'Employer';
    } catch (e) {
      document.getElementById('profile-name').textContent = 'Employer';
    }

    // --- Load jobs ---
    const postedEl = document.getElementById('posted-jobs-container');
    try {
      const jobs = await api('jobs/my/');
      if (!Array.isArray(jobs) || jobs.length === 0) {
        postedEl.innerHTML = '<p class="text-center mt-3">No jobs posted yet.</p>';
        return;
      }

      const posted = jobs.length;
      const active = jobs.filter(j => j.status === 'active').length;
      const closed = jobs.filter(j => j.status !== 'active').length;

      document.getElementById('posted-jobs-count').textContent = posted;
      document.getElementById('active-jobs-count').textContent = active;
      document.getElementById('closed-jobs-count').textContent = closed;

      postedEl.innerHTML = ''; // clear loading
      jobs.slice(0, 5).forEach(j => {
        const title = j.title || 'Untitled Job';
        const jobType = j.job_type || 'N/A';
        const location = j.location || 'N/A';
        postedEl.insertAdjacentHTML('beforeend', `
          <div class="job-item-list d-flex align-items-center border-bottom py-2">
            <div class="job-title flex-grow-1 text-start">
              <h6 class="mb-1"><a href="employer-dashboard-applicants.html?jobId=${j.id}">${title}</a></h6>
              <div class="meta small text-muted"><span>${jobType}</span> Â· <span>${location}</span></div>
            </div>
          </div>
        `);
      });
    } catch (e) {
      postedEl.innerHTML = `<p class="text-danger mt-3">Failed to load jobs. Please try again later.</p>`;
    }

    // --- Logout ---
    document.getElementById('logout-btn').addEventListener('click', e => {
      e.preventDefault();
      localStorage.clear();
      location.href='../../index.html';
    });
  });
  </script>
</div>
</body>
</html>
